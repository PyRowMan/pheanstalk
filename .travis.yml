language: php
dist: trusty
matrix:
  include:
    - php: 7.2
      dist: precise
php:
  - 7.2

addons:
  mariadb: '10.0'

services: mariadb

before_install:
  - sudo mysql -e 'CREATE DATABASE IF NOT EXISTS evqueue;'
  - sudo mysql -e "CREATE USER 'evqueue'@'localhost' IDENTIFIED BY 'password';"
  - sudo mysql -e "GRANT ALL PRIVILEGES ON evqueue.* to 'evqueue'@'localhost' IDENTIFIED BY 'password';"
  - sudo apt-get update -qq
  - sudo apt-get install -y build-essential cmake git libgit2-dev libxerces-c-dev libpcre++-dev openssh-server
  - sudo git clone https://github.com/coldsource/evqueue-core.git
  - cd evqueue-core
  - sudo mkdir build
  - cd build
  - sudo cmake ..
  - sudo make
  - sudo cp evqueue.conf /etc
  - sudo groupadd evqueue
  - sudo useradd -m -g evqueue evqueue
  - sudo apt-get -f install
  - sudo service evqueue start

before_script:
  - travis_retry composer self-update
  - travis_retry composer install --no-interaction --prefer-source --dev

script:
  - vendor/bin/phpunit --configuration phpunit.xml.dist
